# CQRS-представление для Order History

CQRS-представление для операции `findOrderHistory()` потребляет события из нескольких сервисов, поэтому оно реализуется в виде отдельного сервиса **Order View**.  

Этот сервис имеет API, которое реализует две операции:  
- `findOrderHistory()`  
- `findOrder()`  

Хотя последнюю можно реализовать с помощью объединения API, в этом представлении она предоставляется фактически «даром».  

Структура сервиса **Order History** показана на рис. 7.12. Он состоит из набора модулей, каждый из которых имеет определённую обязанность, что упрощает разработку и тестирование.

## Обязанности модулей

- **OrderHistoryEventHandlers**  
  Подписывается на события, публикуемые различными сервисами, и вызывает `OrderHistoryDAO`.

- **OrderHistoryQuery (API)**  
  Реализует конечные точки REST, описанные ранее.

- **OrderHistoryDataAccess**  
  Содержит объект `OrderHistoryDAO`, который определяет методы для обновления и обращения к таблице **MongoDB `ftgo-order-history`**, а также его вспомогательные классы.

- **Таблица MongoDB `ftgo-order-history`**  
  Хранит заказы.


![Альтернативный текст](schema.png)

## Ситуация сейчас
Если вы смогли запустить приложение, и сделать запросы на endpoint-ы наших сервисов,
то знаете, что в MongoDB данные хранятся следующим образом:

```json

[
  {
    "orderId": "7566b201-f7fe-4ba6-9008-4454b22550be",
    "items": [
      "flashcard",
      "keyboard",
      "hdmi-vga adapter"
    ],
    "deliveryStatus": "Finding a courier..",
    "approximateTimeToDeliver": "Calculating.."
  }
]

```

Как видим, заказ создается, но курьеры не подбирают заказ. 
Это из-за того, что сервис DeliveryService не имеет бизнес-логику.
В связи с этим вы должны выполнить задание.

## Задание 1. Написать бизнес-логику сервиса Delivery-Service
- [ ] Добавить endpoint, в котором курьер будет принимать заказ на доставку;
- [ ] Добавить логику публикации события в сервис OrderHistory;
- [ ] После успешного запуска программы, протестировать ново созданные endpoint-ы; 
- [ ] Сделайте запрос на сервис OrderHistory, и удостоверьтесь, что заказ был создан и подобран курьером.

## Задание 2. Познакомившись с архитектурой приложения, вы узнали, что в нашей системе были сделаны несколько упрощений.
- [ ] Предложите идеи о том, как можно улучшить архитектуру, приблизив ее к реальности;
- [ ] Исследуйте какие технологии при этом можно и стоит использовать.

# Удачи!
